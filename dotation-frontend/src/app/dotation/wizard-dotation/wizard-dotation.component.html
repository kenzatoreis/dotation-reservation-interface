<!-- Status Messages -->
<div *ngIf="successMessage" class="bg-green-100 text-green-800 p-3 mb-4 border border-green-300 text-sm">
  {{ successMessage }}
</div>

<div *ngIf="errorMessage" class="bg-red-100 text-red-800 p-3 mb-4 border border-red-300 text-sm">
  {{ errorMessage }}
</div>

<mat-horizontal-stepper linear>
  <!-- TITULAIRE -->
  <mat-step [completed]="titulaireSaved">
    <ng-template matStepLabel>Dotation Titulaire</ng-template>

    <app-dotation-form
      [client]="client"
      [typeDotation]="typeDotation"
      (formSubmitted)="onTitulaireSubmit($event)">
    </app-dotation-form>

    <div class="text-right mt-4">
      <button
        class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 mr-2 disabled:bg-orange-300 "
        [disabled]="!titulaireSaved"
        (click)="generatePDF()">
        Imprimer
      </button>

      <button
        (click)="validateTitulaire()"
        class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 disabled:bg-teal-300"
        type="button">
        Valider
      </button>

      <button
        matStepperNext
        [disabled]="!titulaireSaved"
        class="bg-teal-600 hover:bg-teal-700 text-white ml-2 px-4 py-2 disabled:bg-teal-500"
        type="button">
        Suivant
      </button>
    </div>
  </mat-step>

  <!-- CONJOINT -->
  <mat-step [completed]="conjointSaved || !hasConjointData()">
    <ng-template matStepLabel>Conjoint (optionnel)</ng-template>

    <app-form-conjoint-dotation
      [idReservation]="dotationId"
      (conjointSubmitted)="onConjointSubmit($event)">
    </app-form-conjoint-dotation>

    <div class="text-right mt-4">
      <button
        class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 mr-2 disabled:bg-orange-500"
        [disabled]="!titulaireSaved"
        (click)="generatePDF()">
        Imprimer
      </button>

      <button
        (click)="validateConjoint()"
        class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 disabled:bg-teal-300"
        type="button">
        Valider
      </button>

      <button
        matStepperNext
        class="bg-teal-600 hover:bg-teal-700 text-white ml-2 px-4 py-2"
        type="button">
        Suivant
      </button>

      <button
        matStepperPrevious
        class="bg-gray-500 hover:bg-gray-600 text-white ml-2 px-4 py-2"
        type="button">
        Précédent
      </button>
    </div>
  </mat-step>

  <!-- ENFANTS -->
  <mat-step>
    <ng-template matStepLabel>Enfants (optionnel)</ng-template>

    <app-form-enfant-dotation
      [idReservation]="dotationId"
      [typeDotation]="typeDotation"
      (enfantReady)="onEnfantSubmit($event)"
      (cancelClicked)="onEnfantCancel()">
    </app-form-enfant-dotation>

    <div class="mt-6">
      <h3 class="text-base font-semibold mb-2">Liste des Dotations Enfants</h3>
      <table class="w-full border-collapse text-sm text-left border-t">
        <thead class="bg-gray-100 text-teal-700">
          <tr>
            <th class="p-2">Prénom</th>
            <th class="p-2">Nom</th>
            <th class="p-2">Date de naissance</th>
            <th class="p-2">CIN</th>
            <th class="p-2">Passeport</th>
            <th class="p-2">Montant</th>
            <th class="p-2">Ticket OC</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let enfant of enfants">
            <td class="p-2">{{ enfant.prenom }}</td>
            <td class="p-2">{{ enfant.nom }}</td>
            <td class="p-2">{{ enfant.dateNaissance }}</td>
            <td class="p-2">{{ enfant.cin }}</td>
            <td class="p-2">{{ enfant.numPasseport }}</td>
            <td class="p-2">{{ enfant.montantDemande | number:'1.0-0' }} MAD</td>
            <td class="p-2">{{ enfant.numTicketOc }}</td>
          </tr>
          <tr *ngIf="enfants.length === 0">
            <td colspan="7" class="text-center p-4 text-gray-500">Aucune dotation enfant enregistrée.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="text-right mt-4">
      <button
        matStepperPrevious
        class="bg-gray-500 hover:bg-gray-600 text-white ml-2 px-4 py-2"
        type="button">
        Précédent
      </button>
    </div>
  </mat-step>
</mat-horizontal-stepper>
